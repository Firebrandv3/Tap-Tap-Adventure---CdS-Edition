function printStackTrace(a){var b=a&&a.e?a.e:null,c=a?!!a.guess:!0,d=new printStackTrace.implementation,e=d.run(b);return c?d.guessFunctions(e):e}define("storage",[],function(){var a=Class.extend({init:function(){this.hasLocalStorage()&&localStorage.data?(this.resetData(),hasAlreadyPlayed=!0):this.resetData()},loadData:function(){},resetData:function(){this.data={hasAlreadyPlayed:!1,player:{name:"",weapon:"",armor:"",guild:"",image:""},achievements:{unlocked:[],ratCount:0,skeletonCount:0,totalKills:0,totalDmg:0,totalRevives:0}}},hasLocalStorage:function(){return Modernizr.localstorage},save:function(){this.hasLocalStorage()&&(localStorage.data=JSON.stringify(this.data))},clear:function(){this.hasLocalStorage()&&(localStorage.data="",this.resetData())},hasAlreadyPlayed:function(){return this.data.hasAlreadyPlayed},initPlayer:function(a){this.data.hasAlreadyPlayed=!0,this.setPlayerName(a)},setPlayerName:function(a){this.data.player.name=a,this.save()},setPlayerImage:function(a){this.data.player.image=a,this.save()},setPlayerArmor:function(a){this.data.player.armor=a,this.save()},setPlayerWeapon:function(a){this.data.player.weapon=a,this.save()},setPlayerGuild:function(a){typeof a!="undefined"?(this.data.player.guild={id:a.id,name:a.name,members:JSON.stringify(a.members)},this.save()):(delete this.data.player.guild,this.save())},savePlayer:function(a,b,c,d){this.setPlayerImage(a),this.setPlayerArmor(b),this.setPlayerWeapon(c),this.setPlayerGuild(d)},hasUnlockedAchievement:function(a){return _.include(this.data.achievements.unlocked,a)},unlockAchievement:function(a){if(!this.hasUnlockedAchievement(a)){this.data.achievements.unlocked.push(a),this.save();return!0}return!1},getAchievementCount:function(){return _.size(this.data.achievements.unlocked)},getRatCount:function(){return this.data.achievements.ratCount},incrementRatCount:function(){this.data.achievements.ratCount<10&&(this.data.achievements.ratCount++,this.save())},getSkeletonCount:function(){return this.data.achievements.skeletonCount},incrementSkeletonCount:function(){this.data.achievements.skeletonCount<10&&(this.data.achievements.skeletonCount++,this.save())},getTotalDamageTaken:function(){return this.data.achievements.totalDmg},addDamage:function(a){this.data.achievements.totalDmg<5e3&&(this.data.achievements.totalDmg+=a,this.save())},getTotalKills:function(){return this.data.achievements.totalKills},incrementTotalKills:function(){this.data.achievements.totalKills<50&&(this.data.achievements.totalKills++,this.save())},getTotalRevives:function(){return this.data.achievements.totalRevives},incrementRevives:function(){this.data.achievements.totalRevives<5&&(this.data.achievements.totalRevives++,this.save())}});return a}),define("app",["jquery","storage"],function(a,b){var c=Class.extend({init:function(){this.currentPage=1,this.blinkInterval=null,this.isParchmentReady=!0,this.ready=!1,this.storage=new b,this.watchNameInputInterval=setInterval(this.toggleButton.bind(this),100),this.initFormFields(),this.inventoryNumber=0,this.dropDialogPopuped=!1,localStorage&&localStorage.data?this.frontPage="loadcharacter":this.frontPage="createcharacter"},setGame:function(a){this.game=a,this.isMobile=this.game.renderer.mobile,this.isTablet=this.game.renderer.tablet,this.isDesktop=!this.isMobile&&!this.isTablet,this.supportsWorkers=!!window.Worker,this.ready=!0},initFormFields:function(){var b=this;this.$play=a(".play"),this.getPlayButton=function(){return this.getActiveForm().find(".play span")},this.setPlayButtonState(!0),this.$loginnameinput=a("#loginnameinput"),this.$loginpwinput=a("#loginpwinput"),this.loginFormFields=[this.$loginnameinput,this.$loginpwinput],this.$nameinput=a("#nameinput"),this.$pwinput=a("#pwinput"),this.$pwinput2=a("#pwinput2"),this.$email=a("#emailinput"),this.createNewCharacterFormFields=[this.$nameinput,this.$pwinput,this.$pwinput2,this.$email],this.getUsernameField=function(){return this.createNewCharacterFormActive()?this.$nameinput:this.$loginnameinput},this.getPasswordField=function(){return this.createNewCharacterFormActive()?this.$pwinput:this.$loginpwinput}},center:function(){window.scrollTo(0,1)},canStartGame:function(){return this.isDesktop?this.game&&this.game.map&&this.game.map.isLoaded:this.game},tryStartingGame:function(){if(!this.starting){var a=this,b=this.createNewCharacterFormActive()?"create":"login",c=this.getUsernameField().attr("value"),d=this.getPasswordField().attr("value"),e="",f;b==="create"&&(e=this.$email.attr("value"),f=this.$pwinput2.attr("value"));if(!this.validateFormFields(c,d,f,e))return;this.setPlayButtonState(!1);if(!this.ready||!this.canStartGame())var g=setInterval(function(){log.debug("waiting..."),a.canStartGame()&&(clearInterval(g),a.startGame(b,c,d,e))},100);else this.startGame(b,c,d,e)}},startGame:function(a,b,c,d){var e=this;if(b&&!this.game.started){var f=!1,g=this.config;f||(log.debug("Starting game with build config."),this.game.setServerOptions(g.build.host,g.build.port,b,c,d)),e.isDesktop||e.game.loadMap(),this.center(),this.game.run(a,function(a){if(a.success===!0)e.start();else{e.setPlayButtonState(!0);switch(a.reason){case"invalidlogin":e.addValidationError(null,"The username or password you entered is incorrect."),e.getUsernameField().focus();break;case"userexists":e.addValidationError(e.getUsernameField(),"The username you entered is not available.");break;case"invalidusername":e.addValidationError(e.getUsernameField(),"The username you entered contains invalid characters.");break;case"loggedin":e.addValidationError(e.getUsernameField(),"A player with the specified username is already logged in.");break;case"ban":e.addValidationError(e.getUsernameField(),"You have been banned, appeal on the forum for further assistance.");break;default:e.addValidationError(null,"Failed to launch the game: "+(a.reason?a.reason:"(reason unknown)"))}}})}},start:function(){this.hideIntro(),a("body").addClass("started")},setPlayButtonState:function(b){var c=this,d=this.getPlayButton();b?(this.starting=!1,this.$play.removeClass("loading"),d.click(function(){c.tryStartingGame()}),this.playButtonRestoreText&&d.text(this.playButtonRestoreText)):(this.starting=!0,this.$play.addClass("loading"),d.unbind("click"),this.playButtonRestoreText=d.text(),d.text("Loading...")),a("#boardbutton").click(function(a){c.game&&c.ready&&(c.game.chathandler.hide(),c.game.boardhandler.show())}),a("#gamebutton").click(function(a){c.game&&c.ready&&(c.game.chathandler.show(),c.game.boardhandler.hide())})},getActiveForm:function(){return this.loginFormActive()?a("#loadcharacter"):this.createNewCharacterFormActive()?a("#createcharacter"):null},loginFormActive:function(){return a("#parchment").hasClass("loadcharacter")},createNewCharacterFormActive:function(){return a("#parchment").hasClass("createcharacter")},validateFormFields:function(a,b,c,d){this.clearValidationErrors();if(!a){this.addValidationError(this.getUsernameField(),"Please enter a username.");return!1}if(!b){this.addValidationError(this.getPasswordField(),"Please enter a password.");return!1}if(this.createNewCharacterFormActive()){if(!c){this.addValidationError(this.$pwinput2,"Please confirm your password by typing it again.");return!1}if(b!==c){this.addValidationError(this.$pwinput2,"The passwords you entered do not match. Please make sure you typed the password correctly.");return!1}if(d&&!this.validateEmail(d)){this.addValidationError(this.$email,"The email you entered appears to be invalid. Please enter a valid email (or leave the email blank).");return!1}}return!0},validateEmail:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},addValidationError:function(b,c){a("<span/>",{"class":"validation-error blink",text:c}).appendTo(".validation-summary"),b&&(b.addClass("field-error").select(),b.bind("keypress",function(c){b.removeClass("field-error"),a(".validation-error").remove(),a(this).unbind(c)}))},clearValidationErrors:function(){var b=this.loginFormActive()?this.loginFormFields:this.createNewCharacterFormFields;a.each(b,function(a,b){b.removeClass("field-error")}),a(".validation-error").remove()},setMouseCoordinates:function(b){var c=a("#container").offset(),d=this.game.renderer.getScaleFactor(),e=this.game.renderer.getWidth(),f=this.game.renderer.getHeight(),g=this.game.mouse;g.x=b.pageX-c.left-(this.isMobile?0:5*d),g.y=b.pageY-c.top-(this.isMobile?0:7*d),g.x<=0?g.x=0:g.x>=e&&(g.x=e-1),g.y<=0?g.y=0:g.y>=f&&(g.y=f-1)},initTargetHud:function(){var b=this,c=b.game.renderer.getScaleFactor(),d=a("#inspector .health").width()-12*c,e;this.game.player.onSetTarget(function(c,d,f){var g="#inspector",h=c.sprite,i=(h.animationData.idle_down.length-1)*h.width,j=h.animationData.idle_down.row*h.height;a(g+" .name").text(d),c.healthPoints?a(g+" .health").css("width",Math.round(c.healthPoints/c.maxHp*100)+"%"):a(g+" .health").css("width","0%");var k=Types.getMobLevel(Types.getKindFromString(d));k!==undefined?a(g+" .level").text("Level "+k):a("#inspector .level").text(""),a(g).fadeIn("fast"),f&&(clearTimeout(e),e=null,e=setTimeout(function(){a("#inspector").fadeOut("fast"),b.game.player.inspecting=null},1350))}),b.game.onUpdateTarget(function(b){a("#inspector .health").css("width",Math.round(b.healthPoints/b.maxHp*100)+"%")}),b.game.player.onRemoveTarget(function(c){a("#inspector").fadeOut("fast"),a("#inspector .level").text(""),b.game.player.inspecting=null})},initManaBar:function(){var b=a("#manabar").width();a("#mana").html("<p>MP: 100/100</p>")},initExpBar:function(){var b=a("#expbar").width();this.game.onPlayerExpChange(function(c,d){var e=c/d;e>1?e=1:e<0&&(e=0),a("#exp").css("width",(e*b).toFixed(0)+"px"),a("#expbar").attr("title","Exp: "+(e*100).toFixed(3)+"%")})},initHealthBar:function(){var b=a("#healthbar").width();this.game.onPlayerHealthChange(function(c,d){var e=Math.round(b/d*(c>0?c:0));a("#health").css("width",e+"px"),a("#health").html("<p>HP: "+c+"/"+d+"</p>")}),this.game.onPlayerHurt(this.blinkHealthBar.bind(this))},blinkHealthBar:function(){var b=a("#health");b.addClass("white"),setTimeout(function(){b.removeClass("white")},500)},toggleButton:function(){var b=a("#parchment input").val(),c=a("#createcharacter .play");b&&b.length>0?(c.removeClass("disabled"),a("#character").removeClass("disabled")):(c.addClass("disabled"),a("#character").addClass("disabled"))},hideIntro:function(){clearInterval(this.watchNameInputInterval),a("body").removeClass("intro"),setTimeout(function(){a("body").addClass("game")},500)},showChat:function(){this.game.started&&(a("#chatbox").addClass("active"),a("#chatinput").focus(),a("#chatbutton").addClass("active"))},hideChat:function(){this.game.started&&(a("#chatbox").removeClass("active"),a("#chatinput").blur(),a("#chatbutton").removeClass("active"))},toggleInstructions:function(){a("#achievements").hasClass("active")&&(this.toggleAchievements(),a("#achievementsbutton").removeClass("active")),a("#instructions").toggleClass("active")},toggleAchievements:function(){a("#instructions").hasClass("active")&&(this.toggleInstructions(),a("#helpbutton").removeClass("active"),this.game.closeItemInfo()),this.resetPage(),a("#achievements").toggleClass("active")},resetPage:function(){var b=this,c=a("#achievements");c.hasClass("active")&&c.bind(TRANSITIONEND,function(){c.removeClass("page"+b.currentPage).addClass("page1"),b.currentPage=1,c.unbind(TRANSITIONEND)})},showDropDialog:function(b){this.game.started&&(a("#dropDialog").addClass("active"),a("#dropCount").focus(),a("#dropCount").select(),this.inventoryNumber=b,this.dropDialogPopuped=!0)},hideDropDialog:function(){this.game.started&&(a("#dropDialog").removeClass("active"),a("#dropCount").blur(),this.dropDialogPopuped=!1)},initEquipmentIcons:function(){var b=this.game.renderer.getScaleFactor(),c=function(a){return"img/"+b+"/item-"+a+".png"},d=this.game.player.getWeaponName(),e=this.game.player.getSpriteName(),f=c(d),g=c(e);a("#weapon").css("background-image",'url("'+f+'")'),e!=="firefox"&&a("#armor").css("background-image",'url("'+g+'")')},hideWindows:function(){a("#achievements").hasClass("active")&&(this.toggleAchievements(),a("#achievementsbutton").removeClass("active")),a("#instructions").hasClass("active")&&(this.toggleInstructions(),a("#helpbutton").removeClass("active")),a("body").hasClass("credits")&&this.closeInGameScroll("credits"),a("body").hasClass("legal")&&this.closeInGameScroll("legal"),a("body").hasClass("about")&&this.closeInGameScroll("about"),this.game.closeItemInfo()},showAchievementNotification:function(b,c){var d=a("#achievement-notification"),e=d.find(".name"),f=a("#achievementsbutton");d.removeClass().addClass("active achievement"+b),e.text(c),this.game.storage.getAchievementCount()===1&&(this.blinkInterval=setInterval(function(){f.toggleClass("blink")},500)),setTimeout(function(){d.removeClass("active"),f.removeClass("blink")},5e3)},displayUnlockedAchievement:function(b){var c=a("#achievements li.achievement"+b.id);b&&this.setAchievementData(c,b.name,b.desc),c.addClass("unlocked");var d=parseInt(a("#unlocked-achievements").text());a("#unlocked-achievements").text(d+1)},unlockAchievement:function(b,c){this.showAchievementNotification(b,c),this.displayUnlockedAchievement(b);var d=parseInt(a("#unlocked-achievements").text());a("#unlocked-achievements").text(d+1)},initAchievementList:function(b){var c=this,d=a("#lists"),e=a("#page-tmpl"),f=a("#achievement-tmpl"),g=0,h=0,i=null;_.each(b,function(b){h++;var j=f.clone();j.removeAttr("id"),j.addClass("achievement"+h),b.hidden||c.setAchievementData(j,b.name,b.desc),j.find(".twitter").attr("href","https://twitter.com/home?status=I%20just%20unlocked%20a%20quest:%20"+b.name+"%20on%20%23TapTapAdventure%20join%20today%20at%20www.taptapadventure.com!"),j.show(),j.find("a").click(function(){var b=a(this).attr("href");c.openPopup("twitter",b);return!1}),(h-1)%4===0&&(g++,i=e.clone(),i.attr("id","page"+g),i.show(),d.append(i)),i.append(j)}),a("#total-achievements").text(8)},initUnlockedAchievements:function(b){var c=this,d=0;_.each(b,function(a){a.completed&&(c.displayUnlockedAchievement(a),d++)}),a("#unlocked-achievements").text(d)},setAchievementData:function(a,b,c){a.find(".achievement-name").html(b),a.find(".achievement-description").html(c)},displayUnhiddenAchievement:function(b){var c=a("#achievements li.achievement"+b.id);b&&b.hidden&&(this.setAchievementData(c,b.name,b.desc),this.showAchievementNotification(b.id,b.name,"퀘스트 발견!"),this.game.client.sendAchievement(b.id,"found"))},toggleScrollContent:function(b){var c=a("#parchment").attr("class");this.game.started?(a("#parchment").removeClass().addClass(b),a("body").removeClass("credits legal about").toggleClass(b),this.game.player||a("body").toggleClass("death"),b!=="about"&&a("#helpbutton").removeClass("active")):c!=="animate"&&(c===b?this.animateParchment(c,this.frontPage):this.animateParchment(c,b))},closeInGameScroll:function(b){a("body").removeClass(b),a("#parchment").removeClass(b),this.game.player||a("body").addClass("death"),b==="about"&&a("#helpbutton").removeClass("active")},togglePopulationInfo:function(){a("#population").toggleClass("visible")},openPopup:function(b,c){var d=a(window).height(),e=a(window).width(),f,g,h,i;switch(b){case"twitter":f=450,g=550;break;case"facebook":f=400,g=580}h=d/2-f/2,i=e/2-g/2,newwindow=window.open(c,"name","height="+f+",width="+g+",top="+h+",left="+i),window.focus&&newwindow.focus()},animateParchment:function(b,c){var d=this,e=a("#parchment"),f=1;this.isMobile?e.removeClass(b).addClass(c):this.isParchmentReady&&(this.isTablet&&(f=0),this.isParchmentReady=!this.isParchmentReady,e.toggleClass("animate"),e.removeClass(b),setTimeout(function(){a("#parchment").toggleClass("animate"),e.addClass(c)},f*1e3),setTimeout(function(){d.isParchmentReady=!d.isParchmentReady},f*1e3))},animateMessages:function(){var b=a("#notifications div");b.addClass("top")},resetMessagesPosition:function(){var b=a("#message2").text();a("#notifications div").removeClass("top"),a("#message2").text(""),a("#message1").text(b)},showMessage:function(b){var c=a("#notifications div"),d=a("#notifications #message2");this.animateMessages(),d.text(b),this.messageTimer&&this.resetMessageTimer(),this.messageTimer=setTimeout(function(){c.addClass("top")},5e3)},resetMessageTimer:function(){clearTimeout(this.messageTimer)},resizeUi:function(){if(this.game)if(this.game.started)this.game.resize(),this.initHealthBar(),this.initTargetHud(),this.initExpBar(),this.game.updateBars();else{var a=this.game.renderer.getScaleFactor();this.game.renderer.rescale(a)}}});return c}),function(){function j(a,b){var c=[],d,e,f,g,j,k,l,m,n,o=[1732584193,4023233417,2562383102,271733878,3285377520],p=[1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1518500249,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,1859775393,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,2400959708,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782,3395469782];a[b>>>5]|=128<<24-b%32,a[(b+65>>>9<<4)+15]=b,n=a.length;for(l=0;l<n;l+=16){d=o[0],e=o[1],f=o[2],g=o[3],j=o[4];for(m=0;80>m;m+=1)c[m]=16>m?a[m+l]:(c[m-3]^c[m-8]^c[m-14]^c[m-16])<<1|(c[m-3]^c[m-8]^c[m-14]^c[m-16])>>>31,k=20>m?i(d<<5|d>>>27,e&f^~e&g,j,p[m],c[m]):40>m?i(d<<5|d>>>27,e^f^g,j,p[m],c[m]):60>m?i(d<<5|d>>>27,e&f^e&g^f&g,j,p[m],c[m]):i(d<<5|d>>>27,e^f^g,j,p[m],c[m]),j=g,g=f,f=e<<30|e>>>2,e=d,d=k;o[0]=h(d,o[0]),o[1]=h(e,o[1]),o[2]=h(f,o[2]),o[3]=h(g,o[3]),o[4]=h(j,o[4])}return o}function i(a,b,c,d,e){var f=(a&65535)+(b&65535)+(c&65535)+(d&65535)+(e&65535);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16)&65535)<<16|f&65535}function h(a,b){var c=(a&65535)+(b&65535);return((a>>>16)+(b>>>16)+(c>>>16)&65535)<<16|c&65535}function g(b){var c={outputUpper:!1,b64Pad:"="};try{b.hasOwnProperty("outputUpper")&&(c.outputUpper=b.outputUpper),b.hasOwnProperty("b64Pad")&&(c.b64Pad=b.b64Pad)}catch(d){}"boolean"!=typeof c.outputUpper&&a("Invalid outputUpper formatting option"),"string"!=typeof c.b64Pad&&a("Invalid b64Pad formatting option");return c}function f(a,b){var c="",d=4*a.length,e,f,g;for(e=0;e<d;e+=3){g=(a[e>>>2]>>>8*(3-e%4)&255)<<16|(a[e+1>>>2]>>>8*(3-(e+1)%4)&255)<<8|a[e+2>>>2]>>>8*(3-(e+2)%4)&255;for(f=0;4>f;f+=1)c=8*e+6*f<=32*a.length?c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>>6*(3-f)&63):c+b.b64Pad}return c}function e(a,b){var c="",d=4*a.length,e,f;for(e=0;e<d;e+=1)f=a[e>>>2]>>>8*(3-e%4),c+="0123456789abcdef".charAt(f>>>4&15)+"0123456789abcdef".charAt(f&15);return b.outputUpper?c.toUpperCase():c}function d(b){var c=[],d=0,e,f,g,h,i;-1===b.search(/^[a-zA-Z0-9=+\/]+$/)&&a("Invalid character in base-64 string"),e=b.indexOf("="),b=b.replace(/\=/g,""),-1!==e&&e<b.length&&a("Invalid '=' found in base-64 string");for(f=0;f<b.length;f+=4){i=b.substr(f,4);for(g=h=0;g<i.length;g+=1)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(i[g]),h|=e<<18-6*g;for(g=0;g<i.length-1;g+=1)c[d>>2]|=(h>>>16-8*g&255)<<24-8*(d%4),d+=1}return{value:c,binLen:8*d}}function c(b){var c=[],d=b.length,e,f;0!==d%2&&a("String of HEX type must be in byte increments");for(e=0;e<d;e+=2)f=parseInt(b.substr(e,2),16),isNaN(f)&&a("String of HEX type contains invalid characters"),c[e>>>3]|=f<<24-4*(e%8);return{value:c,binLen:4*d}}function b(a,b){var c=[],d=(1<<b)-1,e=a.length*b,f;for(f=0;f<e;f+=b)c[f>>>5]|=(a.charCodeAt(f/b)&d)<<32-b-f%32;return{value:c,binLen:e}}function a(a){throw a}window.jsSHA=function(h,i,l){var m=null,n=0,o=[0],p=0,q=null,p="undefined"!=typeof l?l:8;8===p||16===p||a("charSize must be 8 or 16"),"HEX"===i?(0!==h.length%2&&a("srcString of HEX type must be in byte increments"),q=c(h),n=q.binLen,o=q.value):"ASCII"===i||"TEXT"===i?(q=b(h,p),n=q.binLen,o=q.value):"B64"===i?(q=d(h),n=q.binLen,o=q.value):a("inputFormat must be HEX, TEXT, ASCII, or B64"),this.getHash=function(b,c,d){var h=null,i=o.slice(),l="";switch(c){case"HEX":h=e;break;case"B64":h=f;break;default:a("format must be HEX or B64")}"SHA-1"===b?(null===m&&(m=j(i,n)),l=h(m,g(d))):a("Chosen SHA variant is not supported");return l},this.getHMAC=function(h,i,l,m,q){var r,t,z,A,C,D,E=[],F=[],G=null;switch(m){case"HEX":r=e;break;case"B64":r=f;break;default:a("outputFormat must be HEX or B64")}"SHA-1"===l?(z=64,D=160):a("Chosen SHA variant is not supported"),"HEX"===i?(G=c(h),C=G.binLen,t=G.value):"ASCII"===i||"TEXT"===i?(G=b(h,p),C=G.binLen,t=G.value):"B64"===i?(G=d(h),C=G.binLen,t=G.value):a("inputFormat must be HEX, TEXT, ASCII, or B64"),h=8*z,i=z/4-1,z<C/8?("SHA-1"===l?t=j(t,C):a("Unexpected error in HMAC implementation"),t[i]&=4294967040):z>C/8&&(t[i]&=4294967040);for(z=0;z<=i;z+=1)E[z]=t[z]^909522486,F[z]=t[z]^1549556828;"SHA-1"===l?A=j(F.concat(j(E.concat(o),h+n)),h+D):a("Unexpected error in HMAC implementation");return r(A,g(q))}}}(),define("lib/sha1",function(){}),Function.prototype.bind=function(a){var b=this;return function(){var c=Array.prototype.slice.call(arguments);return b.apply(a||null,c)}};var isInt=function(a){return a%1===0},TRANSITIONEND="transitionend webkitTransitionEnd oTransitionEnd";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();var getUrlVars=function(){var a={},b=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d});return a};define("util",function(){}),define("entrypoint",["lib/sha1","util"],function(){var a=Class.extend({init:function(){this.hashes={"Obda3tBpL9VXsXsSsv5xB4QKNo4=":function(a){a.player.switchArmor(a.sprites.firefox),a.showNotification("You enter the game as a fox, but not invincible…")}}},execute:function(a){var b=!1,c=getUrlVars().entrance;if(c!=undefined){var d=new jsSHA(c,"TEXT"),e=d.getHash("SHA-1","B64");this.hashes[e]==undefined?a.showNotification("Nice try little scoundrel… bad code, though"):(this.hashes[e](a),b=!0)}return b}});return a}),define("main",["jquery","app","entrypoint"],function(a,b,c){var d,e,f=function(){a(document).ready(function(){d=new b,d.center(),Detect.isWindows()&&a("body").addClass("windows"),Detect.isOpera()&&a("body").addClass("opera"),Detect.isFirefoxAndroid()&&a("#chatinput").removeAttr("placeholder"),a("body").click(function(b){a("#parchment").hasClass("credits")&&d.toggleScrollContent("credits"),a("#parchment").hasClass("legal")&&d.toggleScrollContent("legal"),a("#parchment").hasClass("about")&&d.toggleScrollContent("about")}),a(".barbutton").click(function(){a(this).toggleClass("active")}),a("#chatbutton").click(function(){a("#chatbutton").hasClass("active")?d.showChat():d.hideChat()}),a("#dropAccept").click(function(b){try{var c=parseInt(a("#dropCount").val());c>0&&(c>e.player.inventoryCount[d.inventoryNumber]&&(c=e.player.inventoryCount[d.inventoryNumber]),e.client.sendInventory("empty",d.inventoryNumber,c),e.player.inventoryCount[d.inventoryNumber]-=c,e.player.inventoryCount[d.inventoryNumber]===0&&(e.player.inventory[d.inventoryNumber]=null))}catch(f){}setTimeout(function(){d.hideDropDialog()},950)}),a("#helpbutton").click(function(){a("body").hasClass("about")?(d.closeInGameScroll("about"),a("#helpbutton").removeClass("active")):d.toggleScrollContent("about")}),a("#achievementsbutton").click(function(){d.toggleAchievements(),d.blinkInterval&&clearInterval(d.blinkInterval),a(this).removeClass("blink")}),a("#instructions").click(function(){d.hideWindows()}),a("#population").click(function(){d.togglePopulationInfo()}),a(".clickable").click(function(a){a.stopPropagation()}),a("#toggle-credits").click(function(){d.toggleScrollContent("credits")}),a("#toggle-legal").click(function(){d.toggleScrollContent("legal"),e.renderer.mobile&&(a("#parchment").hasClass("legal")?a(this).text("close"):a(this).text("Privacy"))}),a("#create-new span").click(function(){d.animateParchment("loadcharacter","confirmation")}),a("#continue span").click(function(){d.storage.clear(),d.animateParchment("confirmation","createcharacter"),a("body").removeClass("returning"),d.clearValidationErrors()}),a("#cancel span").click(function(){d.animateParchment("confirmation","loadcharacter")}),a(".ribbon").click(function(){d.toggleScrollContent("about")}),a("#nameinput").bind("keyup",function(){d.toggleButton()}),a("#pwinput").bind("keyup",function(){d.toggleButton()}),a("#pwinput2").bind("keyup",function(){d.toggleButton()}),a("#emailinput").bind("keyup",function(){d.toggleButton()}),a("#previous").click(function(){var b=a("#achievements");if(d.currentPage===1)return!1;d.currentPage-=1,b.removeClass().addClass("active page"+d.currentPage)}),a("#next").click(function(){var b=a("#achievements"),c=a("#lists"),e=c.children("ul").length;if(d.currentPage===e)return!1;d.currentPage+=1,b.removeClass().addClass("active page"+d.currentPage)}),a("#notifications div").bind(TRANSITIONEND,d.resetMessagesPosition.bind(d)),a(".close").click(function(){d.hideWindows()}),a(".twitter").click(function(){var b=a(this).attr("href");d.openPopup("twitter",b);return!1}),a(".facebook").click(function(){var b=a(this).attr("href");d.openPopup("facebook",b);return!1});var c=d.storage.data;c.hasAlreadyPlayed&&c.player.name&&c.player.name!==""&&(a("#playername").html(c.player.name),a("#playerimage").attr("src",c.player.image)),a(".play span").click(function(a){d.tryStartingGame()}),document.addEventListener("touchstart",function(){},!1),a("#resize-check").bind("transitionend",d.resizeUi.bind(d)),a("#resize-check").bind("webkitTransitionEnd",d.resizeUi.bind(d)),a("#resize-check").bind("oTransitionEnd",d.resizeUi.bind(d)),log.info("App initialized."),g()})},g=function(){require(["game"],function(b){var f=document.getElementById("entities"),g=document.getElementById("background"),h=document.getElementById("foreground"),i=document.getElementById("chatinput");e=new b(d),e.setup("#bubbles",f,g,h,i),e.setStorage(d.storage),d.setGame(e),d.isDesktop&&d.supportsWorkers&&e.loadMap(),e.onGameStart(function(){d.initEquipmentIcons();var a=new c;a.execute(e)}),e.onDisconnect(function(b){a("#death").find("p").html(b+"<em>Please reload the page.</em>"),a("#respawn").hide()}),e.onPlayerDeath(function(){a("body").hasClass("credits")&&a("body").removeClass("credits"),a("body").addClass("death")}),e.onPlayerEquipmentChange(function(){d.initEquipmentIcons()}),e.onPlayerInvincible(function(){a("#hitpoints").toggleClass("invincible")}),e.onNbPlayersChange(function(a,b){}),e.onGuildPopulationChange(function(a,b){}),e.onAchievementUnlock(function(a,b,c){d.unlockAchievement(a,b)}),e.onNotification(function(a){d.showMessage(a)}),d.initHealthBar(),d.initManaBar(),d.initExpBar(),a("#nameinput").attr("value",""),a("#pwinput").attr("value",""),a("#pwinput2").attr("value",""),a("#emailinput").attr("value",""),a("#chatbox").attr("value",""),e.renderer.mobile||e.renderer.tablet?a("#foreground").bind("touchstart",function(a){d.center(),d.setMouseCoordinates(a.originalEvent.touches[0]),e.click(),d.hideWindows()}):a("#foreground").click(function(a){d.center(),d.setMouseCoordinates(a),e&&!d.dropDialogPopuped&&e.click(),d.hideWindows()}),a("body").unbind("click"),a("body").click(function(b){var c=!1;a("#parchment").hasClass("credits")&&(e.started?(d.closeInGameScroll("credits"),c=!0):d.toggleScrollContent("credits")),a("#parchment").hasClass("legal")&&(e.started?(d.closeInGameScroll("legal"),c=!0):d.toggleScrollContent("legal")),a("#parchment").hasClass("about")&&(e.started?(d.closeInGameScroll("about"),c=!0):d.toggleScrollContent("about")),e.started&&!e.renderer.mobile&&e.player&&!c&&e.click()}),a("#respawn").click(function(b){e.audioManager.playSound("revive"),e.respawn(),a("body").removeClass("death")}),a(document).mousemove(function(a){d.setMouseCoordinates(a),e.started&&e.movecursor()}),a(document).keyup(function(b){var c=b.which;if(e.started&&!a("#chatbox").hasClass("active"))switch(c){case Types.Keys.LEFT:case Types.Keys.A:case Types.Keys.KEYPAD_4:e.player.moveLeft=!1,e.player.disableKeyboardNpcTalk=!1;break;case Types.Keys.RIGHT:case Types.Keys.D:case Types.Keys.KEYPAD_6:e.player.moveRight=!1,e.player.disableKeyboardNpcTalk=!1;break;case Types.Keys.UP:case Types.Keys.W:case Types.Keys.KEYPAD_8:e.player.moveUp=!1,e.player.disableKeyboardNpcTalk=!1;break;case Types.Keys.DOWN:case Types.Keys.S:case Types.Keys.KEYPAD_2:e.player.moveDown=!1,e.player.disableKeyboardNpcTalk=!1;break;default:}}),a(document).keydown(function(b){var c=b.which,f=a("#chatinput");c===Types.Keys.ENTER&&(a("#chatbox").hasClass("active")?d.hideChat():d.showChat());if(e.started&&!a("#chatbox").hasClass("active")){pos={x:e.player.gridX,y:e.player.gridY};switch(c){case Types.Keys.LEFT:case Types.Keys.A:case Types.Keys.KEYPAD_4:e.player.moveLeft=!0;break;case Types.Keys.RIGHT:case Types.Keys.D:case Types.Keys.KEYPAD_6:e.player.moveRight=!0;break;case Types.Keys.UP:case Types.Keys.W:case Types.Keys.KEYPAD_8:e.player.moveUp=!0;break;case Types.Keys.DOWN:case Types.Keys.S:case Types.Keys.KEYPAD_2:e.player.moveDown=!0;break;case Types.Keys.SPACE:e.makePlayerAttackNext();break;case Types.Keys.I:a("#achievementsbutton").click();break;case Types.Keys.H:a("#helpbutton").click();break;case Types.Keys.M:a("#mutebutton").click();break;default:}}}),a(document).keyup(function(a){var b=a.which}),a("#chatinput").keydown(function(b){var c=b.which,f=a("#chatinput"),g=a(this).attr("placeholder");if(c===13){if(f.attr("value")!==""){e.player&&e.say(f.attr("value")),f.attr("value",""),d.hideChat(),a("#foreground").focus();return!1}d.hideChat();return!1}if(c===27){d.hideChat();return!1}}),a("#chatinput").focus(function(b){var c=a(this).attr("placeholder");Detect.isFirefoxAndroid()||a(this).val(c),a(this).val()===c&&this.setSelectionRange(0,0)}),a("#nameinput").focusin(function(){a("#name-tooltip").addClass("visible")}),a("#nameinput").focusout(function(){a("#name-tooltip").removeClass("visible")}),a("#nameinput").keypress(function(b){a("#name-tooltip").removeClass("visible")}),a("#mutebutton").click(function(){e.audioManager.toggle()}),a(document).bind("keydown",function(b){var c=b.which,f=a("#chatinput");if(c===13){if(e.started){f.focus();return!1}if(d.loginFormActive()||d.createNewCharacterFormActive()){a("input").blur(),d.tryStartingGame();return!1}}if(a("#chatinput:focus").size()===0&&a("#nameinput:focus").size()===0){if(c===27){d.hideWindows(),_.each(e.player.attackers,function(a){a.stop()});return!1}if(c!==49&&c!==50||!e.started)c===107&&e.started?e.chathandler.incChatWindow():c===109&&e.started&&e.chathandler.decChatWindow();else{e.keyDown(c);return!1}if(c===32&&e.started){e.togglePathingGrid();return!1}if(c===70&&e.started){e.toggleDebugInfo();return!1}}}),a("#healthbar").click(function(b){var c=a("#healthbar"),d=a("#hitpoints"),f=a("#hpguide"),g=c.position(),h=d.position();b.offsetX>=h.left&&b.offsetX<c.width()&&(f.css("display")==="none"&&(f.css("display","block"),setInterval(function(){e.player.hitPoints/e.player.maxHitPoints<=e.hpGuide&&e.healShortCut>=0&&Types.isHealingItem(e.player.inventory[e.healShortCut])&&e.player.inventoryCount[e.healShortCut]>0&&e.eat(e.healShortCut)},100)),f.css("left",b.offsetX+"px"),e.hpGuide=(b.offsetX-h.left)/(c.width()-h.left));return!1}),e.renderer.tablet&&a("body").addClass("tablet")})};f()});var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Class=function(){},Class.extend=function(a){var b=this.prototype;initializing=!0;var c=new this;initializing=!1;for(var d in a)c[d]=typeof a[d]=="function"&&typeof b[d]=="function"&&fnTest.test(a[d])?function(a,c){return function(){var d=this._super;this._super=b[a];var e=c.apply(this,arguments);this._super=d;return e}}(d,a[d]):a[d];Class=function(){!initializing&&this.init&&this.init.apply(this,arguments)},Class.prototype=c,Class.constructor=Class,Class.extend=arguments.callee;return Class},typeof exports!="undefined"&&(exports.Class=Class),define("lib/class",function(){}),function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=d.slice,g=d.unshift,h=e.toString,i=e.hasOwnProperty,j=d.forEach,k=d.map,l=d.reduce,m=d.reduceRight,n=d.filter,o=d.every,p=d.some,q=d.indexOf,r=d.lastIndexOf;e=Array.isArray;var s=Object.keys,t=Function.prototype.bind,u=function(a){return new z(a)};typeof module!="undefined"&&module.exports?(module.exports=u,u._=u):a._=u,u.VERSION="1.1.7";var v=u.each=u.forEach=function(a,b,d){if(a!=null)if(j&&a.forEach===j)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)break}else for(e in a)if(i.call(a,e)&&b.call(d,a[e],e,a)===c)break};u.map=function(a,b,c){var d=[];if(a==null)return d;if(k&&a.map===k)return a.map(b,c);v(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)});return d},u.reduce=u.foldl=u.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(l&&a.reduce===l)return d&&(b=u.bind(b,d)),e?a.reduce(b,c):a.reduce(b);v(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},u.reduceRight=u.foldr=function(a,b,c,d){a==null&&(a=[]);if(m&&a.reduceRight===m)return d&&(b=u.bind(b,d)),c!==void 0?a.reduceRight(b,c):a.reduceRight(b);a=(u.isArray(a)?a.slice():u.toArray(a)).reverse();return u.reduce(a,b,c,d)},u.find=u.detect=function(a,b,c){var d;w(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0});return d},u.filter=u.select=function(a,b,c){var d=[];if(a==null)return d;if(n&&a.filter===n)return a.filter(b,c);v(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)});return d},u.reject=function(a,b,c){var d=[];if(a==null)return d;v(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)});return d},u.every=u.all=function(a,b,d){var e=!0;if(a==null)return e;if(o&&a.every===o)return a.every(b,d);v(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c});return e};var w=u.some=u.any=function(a,b,d){b=b||u.identity;var e=!1;if(a==null)return e;if(p&&a.some===p)return a.some(b,d);v(a,function(a,f,g){if(e|=b.call(d,a,f,g))return c});return!!e};u.include=u.contains=function(a,b){var c=!1;if(a==null)return c;if(q&&a.indexOf===q)return a.indexOf(b)!=-1;w(a,function(a){if(c=a===b)return!0});return c},u.invoke=function(a,b){var c=f.call(arguments,2);return u.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},u.pluck=function(a,b){return u.map(a,function(a){return a[b]})},u.max=function(a,b,c){if(!b&&u.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};v(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e>=d.computed&&(d={value:a,computed:e})});return d.value},u.min=function(a,b,c){if(!b&&u.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};v(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e<d.computed&&(d={value:a,computed:e})});return d.value},u.sortBy=function(a,b,c){return u.pluck(u.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},u.groupBy=function(a,b){var c={};v(a,function(a,d){var e=b(a,d);(c[e]||(c[e]=[])).push(a)});return c},u.sortedIndex=function(a,b,c){c||(c=u.identity);for(var d=0,e=a.length;d<e;){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},u.toArray=function(a){return a?a.toArray?a.toArray():u.isArray(a)?f.call(a):u.isArguments(a)?f.call(a):u.values(a):[]},u.size=function(a){return u.toArray(a).length},u.first=u.head=function(a,b,c){return b!=null&&!c?f.call(a,0,b):a[0]},u.rest=u.tail=function(a,b,c){return f.call(a,b==null||c?1:b)},u.last=function(a){return a[a.length-1]},u.compact=function(a){return u.filter(a,function(a){return!!a})},u.flatten=function(a){return u.reduce(a,function(a,b){if(u.isArray(b))return a.concat(u.flatten(b));a[a.length]=b;return a},[])},u.without=function(a){return u.difference(a,f.call(arguments,1))},u.uniq=u.unique=function(a,b){return u.reduce(a,function(a,c,d){if(0==d||(b===!0?u.last(a)!=c:!u.include(a,c)))a[a.length]=c;return a},[])},u.union=function(){return u.uniq(u.flatten(arguments))},u.intersection=u.intersect=function(a){var b=f.call(arguments,1);return u.filter(u.uniq(a),function(a){return u.every(b,function(b){return u.indexOf(b,a)>=0})})},u.difference=function(a,b){return u.filter(a,function(a){return!u.include(b,a)})},u.zip=function(){for(var a=f.call(arguments),b=u.max(u.pluck(a,"length")),c=Array(b),d=0;d<b;d++)c[d]=u.pluck(a,""+d);return c},u.indexOf=function(a,b,c){if(a==null)return-1;var d;if(c)return c=u.sortedIndex(a,b),a[c]===b?c:-1;if(q&&a.indexOf===q)return a.indexOf(b);c=0;for(d=a.length;c<d;c++)if(a[c]===b)return c;return-1},u.lastIndexOf=function(a,b){if(a==null)return-1;if(r&&a.lastIndexOf===r)return a.lastIndexOf(b);for(var c=a.length;c--;)if(a[c]===b)return c;return-1},u.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);e<d;)f[e++]=a,a+=c;return f},u.bind=function(a,b){if(a.bind===t&&t)return t.apply(a,f.call(arguments,1));var c=f.call(arguments,2);return function(){return a.apply(b,c.concat(f.call(arguments)))}},u.bindAll=function(a){var b=f.call(arguments,1);b.length==0&&(b=u.functions(a)),v(b,function(b){a[b]=u.bind(a[b],a)});return a},u.memoize=function(a,b){var c={};b||(b=u.identity);return function(){var d=b.apply(this,arguments);return i.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},u.delay=function(a,b){var c=f.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},u.defer=function(a){return u.delay.apply(u,[a,1].concat(f.call(arguments,1)))};var x=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}};u.throttle=function(a,b){return x(a,b,!1)},u.debounce=function(a,b){return x(a,b,!0)},u.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}},u.wrap=function(a,b){return function(){var c=[a].concat(f.call(arguments));return b.apply(this,c)}},u.compose=function(){var a=f.call(arguments);return function(){for(var b=f.call(arguments),c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},u.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},u.keys=s||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)i.call(a,c)&&(b[b.length]=c);return b},u.values=function(a){return u.map(a,u.identity)},u.functions=u.methods=function(a){var b=[],c;for(c in a)u.isFunction(a[c])&&b.push(c);return b.sort()},u.extend=function(a){v(f.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])});return a},u.defaults=function(a){v(f.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])});return a},u.clone=function(a){return u.isArray(a)?a.slice():u.extend({},a)},u.tap=function(a,b){b(a);return a},u.isEqual=function(a,b){if(a===b)return!0;var c=typeof a;if(c!=typeof b)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual)return a.isEqual(b);if(b.isEqual)return b.isEqual(a);if(u.isDate(a)&&u.isDate(b))return a.getTime()===b.getTime();if(u.isNaN(a)&&u.isNaN(b))return!1;if(u.isRegExp(a)&&u.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object")return!1;if(a.length&&a.length!==b.length)return!1;c=u.keys(a);var d=u.keys(b);if(c.length!=d.length)return!1;for(var e in a)if(!(e in b)||!u.isEqual(a[e],b[e]))return!1;return!0},u.isEmpty=function(a){if(u.isArray(a)||u.isString(a))return a.length===0;for(var b in a)if(i.call(a,b))return!1;return!0},u.isElement=function(a){return!!a&&a.nodeType==1},u.isArray=e||function(a){return h.call(a)==="[object Array]"},u.isObject=function(a){return a===Object(a)},u.isArguments=function(a){return!!a&&!!i.call(a,"callee")},u.isFunction=function(a){return!(!a||!a.constructor||!a.call||!a.apply)},u.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},u.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)},u.isNaN=function(a){return a!==a},u.isBoolean=function(a){return a===!0||a===!1},u.isDate=function(a){return!(!a||!a.getTimezoneOffset||!a.setUTCFullYear)},u.isRegExp=function(a){return!(!a||!a.test||!a.exec||!a.ignoreCase&&a.ignoreCase!==!1)},u.isNull=function(a){return a===null},u.isUndefined=function(a){return a===void 0},u.noConflict=function(){a._=b;return this},u.identity=function(a){return a},u.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},u.mixin=function(a){v(u.functions(a),function(b){B(b,u[b]=a[b])})};var y=0;u.uniqueId=function(a){var b=y++;return a?a+b:b},u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},u.template=function(a,b){var c=u.templateSettings;c="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",c=new Function("obj",c);return b?c(b):c};var z=function(a){this._wrapped=a};u.prototype=z.prototype;var A=function(a,b){return b?u(a).chain():a},B=function(a,b){z.prototype[a]=function(){var a=f.call(arguments);g.call(a,this._wrapped);return A(b.apply(u,a),this._chain)}};u.mixin(u),v(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];z.prototype[a]=function(){b.apply(this._wrapped,arguments);return A(this._wrapped,this._chain)}}),v(["concat","join","slice"],function(a){var b=d[a];z.prototype[a]=function(){return A(b.apply(this._wrapped,arguments),this._chain)}}),z.prototype.chain=function(){this._chain=!0;return this},z.prototype.value=function(){return this._wrapped}}(),define("lib/underscore.min",function(){}),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(a){var b=this._mode||this.mode();if(b==="other")return this.other(arguments.callee);a=a||function(){try{var a=__undef__<<1}catch(b){return b}}();return this[b](a)},mode:function(){try{var a=__undef__<<1}catch(b){if(b.arguments)return this._mode="chrome";if(window.opera&&b.stacktrace)return this._mode="opera10";if(b.stack)return this._mode="firefox";if(window.opera&&!("stacktrace"in b))return this._mode="opera"}return this._mode="other"},instrumentFunction:function(a,b,c){a=a||window,a["_old"+b]=a[b],a[b]=function(){c.call(this,printStackTrace());return a["_old"+b].apply(this,arguments)},a[b]._instrumented=!0},deinstrumentFunction:function(a,b){a[b].constructor===Function&&a[b]._instrumented&&a["_old"+b].constructor===Function&&(a[b]=a["_old"+b])},chrome:function(a){return a.stack.replace(/^[^\n]*\n/,"").replace(/^[^\n]*\n/,"").replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n")},firefox:function(a){return a.stack.replace(/^[^\n]*\n/,"").replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(a){var b=a.stacktrace,c=b.split("\n"),d="{anonymous}",e=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i,f,g,h;for(f=2,g=0,h=c.length;f<h-2;f++)if(e.test(c[f])){var i=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,j=RegExp.$3;j=j.replace(/<anonymous function\s?(\S+)?>/g,d),c[g++]=j+"@"+i}c.splice(g,c.length-g);return c},opera:function(a){var b=a.message.split("\n"),c="{anonymous}",d=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i,e,f,g;for(e=4,f=0,g=b.length;e<g;e+=2)d.test(b[e])&&(b[f++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:c+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+b[e+1].replace(/^\s+/,""));b.splice(f,b.length-f);return b},other:function(a){var b="{anonymous}",c=/function\s*([\w\-$]+)?\s*\(/i,d=[],e=0,f,g,h=10;while(a&&d.length<h)f=c.test(a.toString())?RegExp.$1||b:b,g=Array.prototype.slice.call(a.arguments),d[e++]=f+"("+this.stringifyArguments(g)+")",a=a.caller;return d},stringifyArguments:function(a){for(var b=0;b<a.length;++b){var c=a[b];c===undefined?a[b]="undefined":c===null?a[b]="null":c.constructor&&(c.constructor===Array?c.length<3?a[b]="["+this.stringifyArguments(c)+"]":a[b]="["+this.stringifyArguments(Array.prototype.slice.call(c,0,1))+"..."+this.stringifyArguments(Array.prototype.slice.call(c,-1))+"]":c.constructor===Object?a[b]="#object":c.constructor===Function?a[b]="#function":c.constructor===String&&(a[b]='"'+c+'"'))}return a.join(",")},sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();if(!!b){b.open("GET",a,!1),b.setRequestHeader("User-Agent","XMLHTTP/1.0"),b.send("");return b.responseText}},createXMLHTTPObject:function(){var a,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var c=0;c<b.length;c++)try{a=b[c](),this.createXMLHTTPObject=b[c];return a}catch(d){}},isSameDomain:function(a){return a.indexOf(location.hostname)!==-1},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessFunctions:function(a){for(var b=0;b<a.length;++b){var c=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,d=a[b],e=c.exec(d);if(e){var f=e[1],g=e[4];if(f&&this.isSameDomain(f)&&g){var h=this.guessFunctionName(f,g);a[b]=d.replace("{anonymous}",h)}}}return a},guessFunctionName:function(a,b){try{return this.guessFunctionNameFromLines(b,this.getSource(a))}catch(c){return"getSource failed with url: "+a+", exception: "+c.toString()}},guessFunctionNameFromLines:function(a,b){var c=/function ([^(]*)\(([^)]*)\)/,d=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,e="",f=10;for(var g=0;g<f;++g){e=b[a-g]+e;if(e!==undefined){var h=d.exec(e);if(h&&h[1])return h[1];h=c.exec(e);if(h&&h[1])return h[1]}}return"(?)"}},define("lib/stacktrace",function(){}),define("home",["lib/class","lib/underscore.min","lib/stacktrace","util"],function(){require(["main"])})